# STM32MP25x Architecture Overview

## Top-level
- External clocks: HSE (16-48 MHz), LSE (32.768 kHz)
- External reset: NRST (active low)
- Boot selection: BOOT[3:0] pins

## IP Selection and Counts
### Processor Cores
- Cortex-A35: Up to dual-core, 1.5 GHz, 32KB I$/32KB D$ per core, 512KB L2$
- Cortex-M33: Single core, 400 MHz, 16KB I$/16KB D$, FPU, TrustZone
- Cortex-M0+: Single core, 200 MHz (16 MHz in backup), in SmartRun domain

### Memory Subsystem
- Internal SRAM: Total 808KB
  * SYSRAM: 256KB (AXI, MPU domain)
  * VDERAM: 128KB (video RAM, can be used as general purpose)
  * SRAM1: 128KB (AHB, MCU domain)
  * SRAM2: 128KB (AHB, MCU domain)
  * RETRAM: 128KB (retention, ECC/CRC protected)
  * BKPSRAM: 8KB (backup, tamper protected)
  * LPSRAM1/2/3: 8KB+8KB+16KB (SmartRun domain)

- External SDRAM: Up to 4GB
  * DDR3L: 16/32-bit, up to 2133 MT/s
  * DDR4: 16/32-bit, up to 2400 MT/s  
  * LPDDR4: 16/32-bit, up to 2400 MT/s

### Graphics and AI
- GPU (optional): VeriSilicon GC8000UL, up to 900 MHz
  * OpenGL ES 3.1, Vulkan 1.3, OpenCL 3.0, OpenVX 1.3
  * Performance: 150 Miriangle/s, 900 Mpixel/s
- NPU (optional): VeriSilicon, up to 900 MHz, 1.35 TOPS
  * TensorFlowLite, ONNX, Linux NN

### Video Processing
- Video Encoder/Decoder (optional): Up to 600 MHz
  * H264/VP8 up to 1080p60, JPEG 500 Mpixel/s
  * 128KB shared video RAM

### Communication Interfaces
- I2C: 8x (1 Mbit/s, SMBus/PMBus)
- I3C: 4x (MIPI I3C v1.1)
- USART: 4x + UART: 5x (12.5 Mbit/s)
- SPI: 8x (50 Mbit/s, 3x with I2S)
- SAI: 4x (serial audio interfaces)
- Ethernet: Up to 3x Gigabit (TSN, IEEE 1588)
- USB: 
  * USB 2.0 Host with embedded PHY
  * USB 2.0/3.0 Dual Role with embedded PHYs
  * USB Type-C with Power Delivery
- PCIe: 1 lane Gen2, embedded 5G PHY
- FDCAN: Up to 3x (CAN FD, 1x TTCAN)

### Storage Interfaces
- SDMMC: 3x (SD/eMMC/SDIO)
- OCTOSPI: 2x (serial NOR/NAND, HyperFlash)
- FMC: Flexible memory controller (NOR/NAND/PSRAM)

### Display and Camera
- LCD-TFT: Up to FHD 1080p60, 24-bit RGB
- MIPI DSI (optional): 4 lanes, up to 2.5 Gbit/s each
- LVDS (optional): Dual-link, up to 1.1 Gbit/s per lane
- Camera: 2 interfaces
  * CSI-2: 2 lanes, up to 2.5 Gbit/s, 5MP@30fps
  * Parallel: up to 16-bit, 120 MHz

### Analog and Security
- ADC: 3x 12-bit, up to 5 Msps, 23 channels total
- Security: TrustZone, HASH (SHA-1/2/3), PKA (ECDSA), RNG, tamper detection
- Digital filters: MDF (8 channels), ADF (audio with sound detection)

## Clocks
### Clock Sources
#### External Oscillators
- HSE: 16-48 MHz crystal oscillator
- LSE: 32.768 kHz crystal oscillator (RTC)

#### Internal Oscillators
- HSI: ~64 MHz RC oscillator
- MSI: ~4/16 MHz multi-speed RC oscillator
- LSI: ~32 kHz low-speed RC oscillator

### PLL Configuration
#### Main PLLs (5 separate PLLs excluding external ones)
- PLL1: For Cortex-A35 subsystem (up to 1.5 GHz)
- PLL2: For GPU/NPU (up to 900 MHz)
- PLL3: For DDR controller (up to 1200 MHz)
- PLL4/5/6/7/8: For peripheral clock generation
  * Integer or fractional mode
  * Spread-spectrum function for EMI reduction
  * On-the-fly fractional ratio change capability

#### PLL Features
- Fractional mode support
- Spread spectrum modulation
- Independent output enables
- Dynamic frequency scaling support

### Clock Distribution Tree
#### High-Frequency Domains
- Cortex-A35 domain: 
  * Source: Local PLL1
  * Frequency: Up to 1.5 GHz
  * Modules: A35 cores, L1/L2 caches, SCU

- GPU/NPU domain:
  * Source: Local PLL2  
  * Frequency: Up to 900 MHz
  * Modules: 3D GPU, Neural Processing Unit

- DDR domain:
  * Source: Local PLL3
  * Frequency: Up to 1200 MHz
  * Modules: DDRCTRL, DDRPHYC

#### System Interconnect Domains
- STNoC Interconnect: 128/64-bit multi-layer AXI
  * Frequencies: 600/300/400/200 MHz domains
  * Modules: System buses, memory controllers

- Cortex-M33 domain:
  * Frequency: Up to 400 MHz
  * Modules: M33 core, ICACHE/DCACHE

- MCU Multi-Layer AHB:
  * 400 MHz domain: M33 fast bus, HPDMA, SRAM1/2, RETRAM
  * 200 MHz domain: Peripheral buses (APB1-4)

#### Peripheral Clock Domains
- APB1: 200 MHz - Timers, I2C, USART, SPI
- APB2: 200 MHz - Advanced peripherals
- APB3: 200 MHz - System peripherals  
- APB4: 200 MHz - Security peripherals

#### Low-Power Domains
- SmartRun domain:
  * Cortex-M0+: Up to 200 MHz (16 MHz in backup mode)
  * LPDMA: 4 channels
  * LPSRAM: 32KB total

- Backup domain:
  * LSI: ~32 kHz
  * LSE: 32.768 kHz
  * Modules: RTC, tamper, backup registers, watchdog

### Clock Gating and Management
- Individual clock enable/disable for all peripherals
- Smart clock gating for power optimization
- Two independent clock failure detection (HSE/LSE)
- Two independent wake-up events (Cortex-A35 and Cortex-M33)

## Resets
### Reset Sources Hierarchy

#### Primary Reset Sources
- Power-on reset (POR): Monitors VDD and VDDA18AON
- Power-down reset (PDR): Monitors VDD and VDDA18AON
- Brownout reset (BOR): Optional 2.7V threshold (disabled at 1.8V VDD)
- External NRST pin (active low, bidirectional)
- Independent watchdog timeouts (IWDG1-5)
- System window watchdog (WWDG1-2)
- Software reset via RCC registers
- HSE clock failure detection
- RETRAM CRC or ECC errors

#### Domain-Specific Reset Supervisors
- POR_VDDCORE/PDR_VDDCORE: VDDCORE domain monitoring
- POR_VDDCPU/PDR_VDDCPU: VDDCPU (Cortex-A35) domain monitoring  
- POR_VSW: VSW domain monitoring

### Reset Domains and Scope

#### System Reset (Full Chip Reset)
- Sources: Application reset + low-voltage detection on VDDCORE/VDDCPU
- Scope: All domains except backup domain
- Effect: Complete system reinitialization

#### Application Reset
- Sources: 
  * NRST pin assertion
  * Low-voltage detection on VDD
  * Independent watchdog timeout
  * Software reset command
  * HSE failure
  * RETRAM CRC/ECC error
- Scope: Main system domains

#### Local Resets
- Individual peripheral resets via RCC
- Domain-specific reset controls
- TrustZone-aware reset partitioning

### Reset Distribution by Domain

#### Cortex-A35 Subsystem Reset
- Controlled by: POR_VDDCPU/PDR_VDDCPU
- Synchronization: To A35 clock domain
- Scope: A35 cores, L1/L2 caches, SCU, GIC

#### Cortex-M33 Subsystem Reset  
- Controlled by: System reset + local reset controller
- Synchronization: To M33 clock domain
- Scope: M33 core, NVIC, MPU, FPU

#### Cortex-M0+ SmartRun Domain Reset
- Controlled by: Separate reset controller
- Synchronization: To M0+ clock domain
- Scope: M0+ core, LPSRAM, LPDMA

#### Peripheral Domain Resets
- AXI/AHB/APB peripheral resets
- Individual reset bits in RCC registers
- Clock-domain synchronized de-assertion

#### Backup Domain Reset
- Independent reset control
- Maintained during VBAT operation
- Scope: RTC, tamper, backup registers, backup SRAM

### Reset Characteristics
- Assertion: Generally asynchronous
- De-assertion: Synchronized to respective clock domains
- Polarity: Active low for most signals
- TrustZone: Secure and non-secure reset controls
- Debug: Most resets can be frozen in debug mode

## Bus Interconnect Architecture

### STNoC Multi-Frequency Network (128/64-bit AXI)
#### Main System Interconnect
- **Topology**: Multi-layer AXI interconnect
- **Data Width**: 128-bit and 64-bit paths
- **Operating Frequencies**: 
  * 600 MHz: High-performance paths
  * 300/400/200 MHz: Domain-specific paths
- **QoS Support**: Up to 16 QoS levels, 3 traffic classes per direction

#### STNoC Masters
- Cortex-A35 subsystem (dual A35 cores + L2 cache)
- GPU (3D graphics processor)
- NPU (neural processing unit)
- HPDMA1/2/3 (48 channels total)
- Video Encoder/Decoder
- Display controllers (LTDC, DSI, LVDS)
- Camera interfaces (CSI, DCMIPP)
- Ethernet controllers (ETH1/2)
- USB 3.0 Dual Role controller
- PCI Express controller

#### STNoC Slaves
- DDR Controller (DDRCTRL) - 2×128-bit AXI4 ports
- Internal SRAM blocks (SYSRAM, VDERAM)
- APB bridges for peripheral access
- AHB bridges for MCU domain connectivity

### MCU Multi-Layer AHB (32-bit)

#### 400 MHz MLAHB (Cortex-M33 Domain)
**Masters:**
- Cortex-M33 core (I-Fast, I-Slow, S-Bus, D-Fetch interfaces)
- HPDMA1/2/3 controllers
- OCTOSPI memory access

**Slaves:**
- SRAM1 (128KB) with hardware erase on tamper
- SRAM2 (128KB) 
- RETRAM (128KB) with ECC/CRC protection
- OCTOSPI1/2 register interfaces
- Connection to MPU matrix
- Connection to 200 MHz MLAHB

#### 200 MHz MLAHB (Peripheral Domain)
**Masters:**
- 400 MHz MLAHB bridge
- HPDMA1/2/3 controllers

**Slaves:**
- APB1 bridge: Timers, I2C, basic peripherals
- APB2 bridge: Advanced peripherals  
- APB3 bridge: System peripherals
- APB4 bridge: Security peripherals
- AHB3 bridge: Additional peripherals
- AHB4 bridge: System functions
- AHB5 bridge: Connectivity
- AHB6 bridge: External interfaces
- Connection to SmartRun AHB matrix
- Connection to MPU matrix

### SmartRun Multi-Layer AHB (32-bit)

#### 200/16 MHz MLAHB (Low-Power Domain)
**Masters:**
- Cortex-M0+ processor
- LPDMA1 controller (4 channels)
- MCU 200 MHz MLAHB bridge

**Slaves:**
- LPSRAM1 (8KB) with retention
- LPSRAM2 (8KB) with retention  
- LPSRAM3 (16KB)
- APB SmartRun bridge
- PWR (power management)
- IPCC2 (inter-processor communication)
- HSEM (hardware semaphore)
- EXTI2 (extended interrupts)
- ADF1 (audio digital filter)
- GPIOZ (special GPIOs)
- Connection to AHB3 RIFSC submatrix

### Peripheral Bus Hierarchy

#### APB1 (200 MHz)
- **Peripherals**:
  * TIM2/TIM3/TIM4/TIM5 (32-bit general purpose timers)
  * TIM6/TIM7 (16-bit basic timers)
  * TIM10/TIM11/TIM13/TIM14 (16-bit general purpose timers)
  * TIM12 (16-bit general purpose timer)
  * LPTIM1/LPTIM2 (low-power timers)
  * I2C1/I2C2/I2C3/I2C4/I2C5/I2C6/I2C7/I2C8
  * USART2/USART3
  * UART4/UART5
  * SPI2/SPI3 (with I2S2/I2S3)
  * SPDIFRX
  * I3C1/I3C2/I3C3

#### APB2 (200 MHz)
- **Peripherals**:
  * TIM1/TIM8/TIM20 (16-bit advanced motor control timers)
  * TIM15/TIM16/TIM17 (16-bit general purpose timers)
  * USART1/USART6
  * UART7/UART8/UART9
  * SPI1 (with I2S1)
  * SPI4/SPI5/SPI6/SPI7/SPI8
  * SAI1/SAI2/SAI3/SAI4
  * FDCAN1/FDCAN2/FDCAN3
  * MDF1 (multi-function digital filter)
  * ADF1 (audio digital filter)

#### APB3 (200 MHz)
- **Peripherals**:
  * System control and configuration
  * SYSCFG (system configuration)
  * RCC (reset and clock control)
  * PWR (power control)
  * TAMP (tamper and backup)
  * RTC (real-time clock)
  * CRC (cyclic redundancy check)
  * HSEM (hardware semaphore)
  * IPCC1 (inter-processor communication)

#### APB4 (200 MHz)
- **Peripherals**:
  * Security peripherals
  * HASH processor
  * PKA (public key accelerator)
  * RNG (random number generator)
  * BSEC (boot and security OTP control)
  * RIF (resource isolation framework)

### DMA Subsystem

#### High-Performance DMA (HPDMA)
- **Instances**: 3 (HPDMA1, HPDMA2, HPDMA3)
- **Channels**: 16 channels each (48 total)
- **Bus Interfaces**: AXI master + AHB master
- **Features**:
  * Memory-mapped transfers (periph↔memory, memory↔memory, periph↔periph)
  * Autonomous operation in Sleep/Stop modes
  * Per-channel event and interrupt generation
  * Linked-list support
  * TrustZone and privilege support
  * Channel isolation
  * FIFO buffering

#### Low-Power DMA (LPDMA)
- **Instance**: 1 (LPDMA1)
- **Channels**: 4 channels
- **Bus Interface**: AHB master
- **Features**:
  * Memory-mapped transfers
  * Autonomous operation in low-power modes
  * Linked-list support
  * TrustZone and privilege support
  * Channel isolation

### Resource Isolation Framework (RIF)

#### Hardware Isolation
- **Compartments**: 8 hardware execution compartments
- **Access Control**: Privileged/unprivileged, secure/non-secure
- **Scope**: Memory regions, peripherals, embedded buffers
- **Extended to**: FMC, SYSCFG, IPCC, HSEM, DMA, RTC, TAMP, RCC, PWR, EXTI, GPIO

### Address Mapping Strategy

#### Memory Regions
- **Boot ROM**: Fixed address for Cortex-A35 boot code
- **Internal SRAM**: Distributed across domains with different attributes
- **Peripheral Buses**: APB1-4 with structured address allocation
- **External Memory**: DDR space with configurable mappings

#### Security Partitioning
- TrustZone memory partitioning
- Secure and non-secure address spaces
- Hardware-enforced access controls

## Power Scheme
### Power Domains
- VDD: Main I/O supply (1.8V or 3.3V)
- VDDCORE: Digital core supply
- VDDCPU: Cortex-A35 supply
- VDDGPU: GPU/NPU supply (optional)
- VBAT: Backup domain supply
- VDDIO1/2/3/4: Separate I/O supplies for different interfaces
- VDDA18*: Multiple 1.8V analog supplies

### Power Management
- Multiple low-power modes:
  * Sleep, Stop, Standby modes
  * DDR retention in Standby
  * Autonomous domains for low-power operation
- Dynamic Voltage Frequency Scaling (DVFS)
- Power switches for RETRAM, BKPSRAM, SmartRun domains

### Always-On Domain
- Backup domain: RTC, tamper, backup registers
- SmartRun domain: Cortex-M0+, LPSRAM, low-power peripherals

## Top-level I/O
### Critical Interfaces
- DDR: 16/32-bit data, address/command/control signals
- Ethernet: RGMII/MII/RMII (up to 3 interfaces)
- USB: Multiple differential pairs (HS/SS)
- PCIe: Differential serial lane
- Display: MIPI DSI (4 lanes), LVDS (dual-link)
- Camera: MIPI CSI-2 (2 lanes), parallel interfaces
- OCTOSPI: 8-bit serial flash interfaces (2x)

### GPIO
- Up to 172 secure I/O ports
- 6 wake-up inputs
- 8 tamper inputs + 8 active tamper outputs
- Multiple supply domains (VDDIO1-4)

### Clock and Reset
- HSE, LSE crystal interfaces
- NRST (reset input/output)
- Multiple clock outputs for external devices

## Key Constraints and Strategies
### Timing Domain Crossings
- Multiple clock domain synchronizers
- Asynchronous FIFOs for data transfer between domains
- Clock gating for power management

### Isolation and Level Conversion
- TrustZone security isolation
- Voltage level shifters between different supply domains
- Resource isolation framework (RIF) for hardware compartmentalization

### Low-Power Strategy
- Hierarchical clock gating
- Power domain partitioning
- Autonomous operation in low-power modes
- Wake-up event management from multiple sources
- DDR self-refresh and retention modes

### Security Constraints
- Secure and non-secure worlds separation
- Tamper detection and response
- Cryptographic acceleration with side-channel protection
- Secure boot and OTP fuse management